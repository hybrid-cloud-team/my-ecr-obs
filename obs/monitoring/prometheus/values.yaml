# ======================================================
# 1. Prometheus Operator
#   - admission webhook ì™„ì „ ë¹„í™œì„±í™” (RBAC ì¬ìƒì„± ì°¨ë‹¨)
# ======================================================
prometheusOperator:
  enabled: true

  admissionWebhooks:
    enabled: false
    patch:
      enabled: false
    certManager:
      enabled: false

  tls:
    enabled: false

# ======================================================
# 2. Prometheus
# ======================================================
prometheus:
  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'
      alb.ingress.kubernetes.io/healthcheck-path: /-/healthy
      alb.ingress.kubernetes.io/success-codes: '200,302'
    # ğŸ”´ ìˆ˜ì • í¬ì¸íŠ¸: "" ëŒ€ì‹  ì•„ë˜ì²˜ëŸ¼ ë¹„ì›Œë‘ì„¸ìš”.
    hosts: [] 
    paths:
      - /
    pathType: Prefix

  prometheusSpec:
    externalLabels:
      cluster: "eks-cluster"
    retention: 2d

    thanos:
      image: quay.io/thanos/thanos:v0.31.0
      version: v0.31.0
      objectStorageConfig:
        name: thanos-objstore-config
        key: objstore.yml

# ======================================================
# 3. Alertmanager
# ======================================================
alertmanager:
  enabled: true
  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'
      alb.ingress.kubernetes.io/healthcheck-path: /-/healthy
      alb.ingress.kubernetes.io/success-codes: '200'
    # ğŸ”´ ìˆ˜ì • í¬ì¸íŠ¸: "" ëŒ€ì‹  ì•„ë˜ì²˜ëŸ¼ ë¹„ì›Œë‘ì„¸ìš”.
    hosts: []
    paths:
      - /
    pathType: Prefix

  # ğŸ”´ Alertmanager ì‹¤ì œ ë™ì‘ ì„¤ì • (ì´ ìœ„ì¹˜ê°€ í•µì‹¬)
  config:
    global:
      resolve_timeout: 5m

    route:
      receiver: route53-webhook
      group_by: ["alertname"]
      group_wait: 10s
      group_interval: 30s
      repeat_interval: 1m

      routes:
        - matchers:
            - alertname=~"ONPREM_OKD_CPU_.*"
          receiver: route53-webhook

        - matchers:
            - alertname=~"AWS_EKS_CPU_.*"
          receiver: route53-webhook

    receivers:
      - name: route53-webhook
        webhook_configs:
          - url: "https://hk8fwhdboc.execute-api.us-east-1.amazonaws.com/prod"
            send_resolved: true

  alertmanagerSpec:
    externalUrl: "http://k8s-monitoringalbgrou-9a6446449e-137211545.us-east-1.elb.amazonaws.com/alertmanager"
    routePrefix: /
